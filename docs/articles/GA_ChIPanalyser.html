<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ChIPanalyser">
<title>The ChIPanalyser User's Guide â€¢ ChIPanalyser</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The ChIPanalyser User's Guide">
<meta property="og:description" content="ChIPanalyser">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ChIPanalyser</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ChIPanalyser.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/GA_ChIPanalyser.html">The ChIPanalyser User's Guide</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>The ChIPanalyser User's Guide</h1>
                        <h4 data-toc-skip class="author">Patrick
Martin</h4>
            
      
      
      <div class="d-none name"><code>GA_ChIPanalyser.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction---what-is-this-package">Introduction - What is this package?<a class="anchor" aria-label="anchor" href="#introduction---what-is-this-package"></a>
</h2>
<p>ChIPanalyser provides a quick an easy method to predict and explain
TF binding. The package uses a statistical thermodynamic framework to
model the binding of proteins to DNA.</p>
<p>The model assumes that there are four main driver to TF binding:</p>
<ul>
<li>Chromatin State affinity</li>
<li>Binding Energy</li>
<li>Number of bound Molecules</li>
<li>Scaling Factor modulating binding affinity</li>
</ul>
<p>While binding energy is given by PWM matrices, the other parameters
will be inferred by maximizing or minimizing a goodness of fit score
between ChIP data and ChIPanalyser predictions. To do so, ChIPanalyser
provides a genetic algorithm to infer optimal values for each
parameter.</p>
</div>
<div class="section level2">
<h2 id="methods---the-chromatin-state-model">Methods - The Chromatin State Model<a class="anchor" aria-label="anchor" href="#methods---the-chromatin-state-model"></a>
</h2>
<p>The chromatin state model is described by the following equation
derived from statistical thermodynamics:</p>
<p><span class="math display">\[P(N,a,\lambda,\omega)_j = \frac{N \cdot
a_{j} \cdot e^{(\frac{1}{\lambda} \cdot \omega_{j})}}{N \cdot a_{j}
\cdot e^{(\frac{1}{\lambda} \cdot \omega_{j})}+ L \cdot n \cdot [a_{i}
\cdot e^{(\frac{1}{\lambda} \cdot \omega_{j})}]_ {i}} \]</span></p>
<ul>
<li>
<span class="math inline">\(N\)</span> , the average number of bound
molecules</li>
<li>
<span class="math inline">\(a_{j}\)</span> , chromatin state
affinity at site j</li>
<li>
<span class="math inline">\(\omega\)</span> , the binding energy
required for a TF to bind to site <span class="math inline">\(j\)</span>
- in the form of a Position Weight Matrix Score</li>
<li>
<span class="math inline">\(\lambda\)</span> , a scaling factor for
the Position Weight Matrix score</li>
<li>
<span class="math inline">\(L\)</span> , the length of the genome of
interest</li>
<li>
<span class="math inline">\(n\)</span> , the ploidy level of the
organism</li>
</ul>
<p>Chromatin state affinity is defined as the following:</p>
<p><span class="math display">\[a_{j} = \sum_{k} \alpha_k \cdot
c_{j}^k\]</span></p>
<p>with <span class="math inline">\(\alpha\)</span> the chromatin state
affinity scores for a given TF and <span class="math inline">\(c\)</span> the chromatin state at site <span class="math inline">\(j\)</span>.</p>
<p>Shortly, the model above generates ChIP like profiles and describes
the affinity of a TF to chromatin states. The affinity scores <span class="math inline">\(a\)</span>, the number of bound molecules <span class="math inline">\(N\)</span>, and lambda <span class="math inline">\(\lambda\)</span> are inferred by optimising the
fit between predicted profiles and ChIP data using a genetic
algortihm.</p>
</div>
<div class="section level2">
<h2 id="using-chipanalyser">Using ChIPanalyser<a class="anchor" aria-label="anchor" href="#using-chipanalyser"></a>
</h2>
<div class="section level3">
<h3 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<p>To demonstrate the use of ChIPanalyser and the genetic algorithm, we
provide some internal data sets. We complement this data with external
data source such a DNA sequence sets taken from the
<code>BSgenome</code>package suit.</p>
<div class="section level4">
<h4 id="chipanalyser">ChIPanalyser<a class="anchor" aria-label="anchor" href="#chipanalyser"></a>
</h4>
<p>First, we load ChIPanlyser and the internal data</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ChIPanalyser</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: GenomicRanges</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: stats4</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: BiocGenerics</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'BiocGenerics'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     IQR, mad, sd, var, xtabs</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     anyDuplicated, append, as.data.frame, basename, cbind, colnames,</span></span>
<span><span class="co">##     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,</span></span>
<span><span class="co">##     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,</span></span>
<span><span class="co">##     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,</span></span>
<span><span class="co">##     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,</span></span>
<span><span class="co">##     union, unique, unsplit, which.max, which.min</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: S4Vectors</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'S4Vectors'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     expand.grid, I, unname</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: IRanges</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenomeInfoDb</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: Biostrings</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: XVector</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'Biostrings'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     strsplit</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: BSgenome</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: rtracklayer</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: RcppRoll</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: parallel</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'ChIPanalyser'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:IRanges':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     drop</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     drop</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Input data </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ChIPanalyserData</span><span class="op">)</span></span>
<span><span class="co"># PFM Matrix </span></span>
<span><span class="va">PFM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,package<span class="op">=</span><span class="st">"ChIPanalyser"</span><span class="op">)</span>,<span class="st">"BEAF-32.pfm"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="external-data">External Data<a class="anchor" aria-label="anchor" href="#external-data"></a>
</h4>
<p>To reduce the size of the internal data size, we complement our data
with the <em>Drosophila</em> DNA sequence taken from the BSgenome
package suit.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BSgenome.Dmelanogaster.UCSC.dm6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DNASequenceSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/getSeq.html" class="external-link">getSeq</a></span><span class="op">(</span><span class="va">BSgenome.Dmelanogaster.UCSC.dm6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="input-data-what-is-it">Input data : What is it?<a class="anchor" aria-label="anchor" href="#input-data-what-is-it"></a>
</h4>
<p>Now we that have loaded some data, what exactly are we looking at?
The environment should contain the following new objects:</p>
<ul>
<li><p><em>chip</em> - GRanges object containing ChIP scores.
Essentially, ChIP data that will be used to <em>train</em> our
model.</p></li>
<li><p><em>cs</em> - GRanges object containing Chromatin State (CS)
information. Essentially, where each CS can be found in the
genome.</p></li>
<li><p><em>top</em> - GRanges object containing regions of interest.
Esssentially, the genomic regions we will use for training and
testing.</p></li>
<li><p><em>PFM</em> - Path to file containing the Position Frequency
Matrix. Essentially, this represents the binding affinity of our TF
(here we are using BEAF-32)</p></li>
<li><p><em>DNASequenceSet</em> - DNAStringSet containing the
DNASequenceSet of the organism we are looking at.</p></li>
<li><p><em>geneRef</em> - GRanges object containing gene reference taken
from the (Genome UCSC website)[<a href="https://genome.ucsc.edu/" class="external-link uri">https://genome.ucsc.edu/</a>]</p></li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="setting-parameters">Setting Parameters<a class="anchor" aria-label="anchor" href="#setting-parameters"></a>
</h3>
<p>The next step consitst in setting initial parameters to run the
genetic algorithm.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of individuals per generation </span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fl">10</span> </span>
<span></span>
<span><span class="co"># Number of generations </span></span>
<span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Mutation Probability </span></span>
<span><span class="va">mut</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span></span>
<span><span class="co"># Children - Number of ofspring passed to the next generation </span></span>
<span><span class="va">child</span> <span class="op">&lt;-</span> <span class="fl">2</span> </span>
<span></span>
<span><span class="co"># Method - Goodness of fit metric used to optimise the Genetic algorithm </span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"MSE"</span></span></code></pre></div>
<p>Please note that the parameters presented here are for the sake of
the vignette. We recommend using the following parameters for a first
trial with your own data. Please be advised that these parameters will
depend on the nature of the data you are using.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of individuals per generation </span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fl">100</span> </span>
<span></span>
<span><span class="co"># Number of generations </span></span>
<span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># Mutation Probability </span></span>
<span><span class="va">mut</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span></span>
<span><span class="co"># Children - Number of ofspring passed to the next generation </span></span>
<span><span class="va">child</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Method - Goodness of fit metric used to optimise the Genetic algorithm </span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"MSE"</span></span></code></pre></div>
<p>We can also define which parameters we wish to optimise. In this
example, we will optimise the number of bound molecules (<span class="math inline">\(N\)</span>), lambda (<span class="math inline">\(\lambda\)</span>), the PWM Threshold and 11
different chromatin states.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parameters to optimised</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>,<span class="st">"lambda"</span>,<span class="st">"PWMThreshold"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CS"</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we can also set custom ranges for the parameters. We
will use custom ranges here to reduce computational time.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">14</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">params_custom</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>,<span class="st">"lambda"</span>,<span class="st">"PWMThreshold"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CS"</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># vector in the format of min value, max value and number of values </span></span>
<span><span class="va">params_custom</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1000000</span>,<span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">params_custom</span><span class="op">$</span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bound between 0 and 1 </span></span>
<span><span class="va">params_custom</span><span class="op">$</span><span class="va">PWMThreshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.9</span>,<span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bound between 0 and 1 </span></span>
<span><span class="va">CS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">CS_loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"CS"</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">params_custom</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">CS_loc</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params_custom</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">CS</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initializing-chipanalyser">Initializing ChIPanalyser<a class="anchor" aria-label="anchor" href="#initializing-chipanalyser"></a>
</h3>
<div class="section level4">
<h4 id="building-initial-objects">Building Initial objects<a class="anchor" aria-label="anchor" href="#building-initial-objects"></a>
</h4>
<p>The first step of any ChIPanalyser anaylsis is to create parameter
object. These object contain input paramters and hold basic data. Here,
we will load the PFM as PWM and compute the Base Pair Frequency from the
DNASequenceSet.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GPP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genomicProfiles.html">genomicProfiles</a></span><span class="op">(</span>PFM<span class="op">=</span><span class="va">PFM</span>,PFMFormat<span class="op">=</span><span class="st">"JASPAR"</span>, BPFrequency<span class="op">=</span><span class="va">DNASequenceSet</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="generating-a-starting-population">Generating a starting population<a class="anchor" aria-label="anchor" href="#generating-a-starting-population"></a>
</h4>
<p>For clairty, we will show what a starting population looks like. This
step is not stricly required as the <code>evolve</code> function can
take the number of individuals in the poppulation (defined above by
<code>pop</code>) and the parameters to be optimised (defined above by
<code>params</code> or <code>params_custom</code>).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateStartingPopulation.html">generateStartingPopulation</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">params_custom</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pre-processing-chip-data">Pre-processing ChIP data<a class="anchor" aria-label="anchor" href="#pre-processing-chip-data"></a>
</h4>
<p>We will pre-proccess the ChIP data by reducing noise and converting
GRanges to a ChIPscore object. This object contains normalised and
smoothed ChIP scores that will be used to train and test the model.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chipProfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/processingChIP.html">processingChIP</a></span><span class="op">(</span><span class="va">chip</span>,loci <span class="op">=</span> <span class="va">top</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Splitting data into training and testing</span></span>
<span><span class="co"># We recommend setting dist to 20/80. However, here we only have 4 loci. </span></span>
<span><span class="va">splitdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splitData.html">splitData</a></span><span class="op">(</span><span class="va">chipProfile</span>,dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">50</span><span class="op">)</span>,as.proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trainingSet</span> <span class="op">&lt;-</span> <span class="va">splitdata</span><span class="op">$</span><span class="va">trainingSet</span></span>
<span><span class="va">testingSet</span> <span class="op">&lt;-</span> <span class="va">splitdata</span><span class="op">$</span><span class="va">testingSet</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="evolution">Evolution<a class="anchor" aria-label="anchor" href="#evolution"></a>
</h3>
<p>We can run the Genetic algorithm provided by ChIPanalyser using a
single function. The function will generate intermediate files that
allow you to check the status of the algorithm while it is running. It
should be noted that the intermediate files are updated at each
generation. This method also provides a lambda database. This allows for
a faster run time on larger data sets as all values for lambda are
pre-computed.</p>
<p>If you do not want intermediate files, set the
<code>checkpoint</code> argument to <code>FALSE</code>.</p>
<p>If you do not want to pre-compute lambda values, set the
<code>lambda</code> argument to <code>FALSE</code>.</p>
<p>For the purpose of this vignette, we will not save intermediate
files.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evolve.html">evolve</a></span><span class="op">(</span>population <span class="op">=</span> <span class="va">pop</span>,</span>
<span>    DNASequenceSet <span class="op">=</span> <span class="va">DNASequenceSet</span>,</span>
<span>    ChIPScore <span class="op">=</span> <span class="va">trainingSet</span>,</span>
<span>    genomicProfiles <span class="op">=</span> <span class="va">GPP</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">params_custom</span>,</span>
<span>    mutationProbability <span class="op">=</span> <span class="va">mut</span>,</span>
<span>    generations <span class="op">=</span> <span class="va">gen</span>,</span>
<span>    offsprings <span class="op">=</span> <span class="va">child</span>,</span>
<span>    chromatinState <span class="op">=</span> <span class="va">cs</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span>,</span>
<span>    filename <span class="op">=</span> <span class="st">"This_TF_is_Best_TF"</span>,</span>
<span>    checkpoint <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    cores<span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Generating Lambda DataBase</span></span></code></pre>
<pre><code><span><span class="co">## Generation: 1</span></span></code></pre>
<pre><code><span><span class="co">## Generation Fitness: c(MSEMean = 0.0152890975452475)</span></span></code></pre>
<pre><code><span><span class="co">## Generation: 2</span></span></code></pre>
<pre><code><span><span class="co">## Generation Fitness: c(MSEMean = 0.0152876578576124)</span></span></code></pre>
<p>The output of this function returns a list of 3 elements:</p>
<ul>
<li>
<em>database</em> - a data frame with all parameters that have been
computed through out each generation</li>
<li>
<em>poppulation</em> - list containing the last generated
population</li>
<li>
<em>fitest</em> - list containing goodness of metric for best
perfomring individuals</li>
</ul>
</div>
<div class="section level3">
<h3 id="fitest-of-them-all">Fitest of them all<a class="anchor" aria-label="anchor" href="#fitest-of-them-all"></a>
</h3>
<p>Once we have the best perfomring paramters, we can plug them into a
single run of ChIPanalyser and use these parameters on a tesing set.</p>
<div class="section level4">
<h4 id="get-fitest-individual">Get fitest individual<a class="anchor" aria-label="anchor" href="#get-fitest-individual"></a>
</h4>
<p>The first step is to extract the best performing individual and its
associated traits from the population.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SuperFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getHighestFitnessSolutions.html">getHighestFitnessSolutions</a></span><span class="op">(</span><span class="va">evo</span><span class="op">$</span><span class="va">population</span>,child<span class="op">=</span><span class="fl">1</span>,method<span class="op">=</span><span class="va">method</span><span class="op">)</span></span>
<span><span class="va">single</span><span class="op">&lt;-</span><span class="va">evo</span><span class="op">[[</span><span class="st">"population"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">SuperFit</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="running-chipanalyser-with-fitest-individual">Running ChIPanalyser with fitest individual<a class="anchor" aria-label="anchor" href="#running-chipanalyser-with-fitest-individual"></a>
</h4>
<p>We can use these parameters as input to the <code>singleRun</code>
function to obtain the ChIP like profiles. This run represents the
predicted run and TF binding affinity of our TF of choice. We will set
fitness to <code>all</code>. This means that the function will return
all goodness of fit metrics available.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set chromatin states for single run - create CS Granges with affinity scores</span></span>
<span><span class="va">cs_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setChromatinStates.html">setChromatinStates</a></span><span class="op">(</span><span class="va">single</span>,<span class="va">cs</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">superFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/singleRun.html">singleRun</a></span><span class="op">(</span>indiv <span class="op">=</span> <span class="va">single</span>,</span>
<span>    DNAAffinity <span class="op">=</span> <span class="va">cs_single</span>,</span>
<span>    genomicProfiles <span class="op">=</span> <span class="va">GPP</span>,</span>
<span>    DNASequenceSet <span class="op">=</span> <span class="va">DNASequenceSet</span>,</span>
<span>    ChIPScore <span class="op">=</span> <span class="va">testingSet</span>,</span>
<span>    fitness <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in ks.test.default(predicted, locusProfile): p-value will be approximate</span></span>
<span><span class="co">## in the presence of ties</span></span>
<span></span>
<span><span class="co">## Warning in ks.test.default(predicted, locusProfile): p-value will be approximate</span></span>
<span><span class="co">## in the presence of ties</span></span></code></pre>
<p>This final sections returns a list containing 3 elements:</p>
<ul>
<li>
<em>occupnacy</em> - genomicProfiles object containing occupancy
scores for each region</li>
<li>
<em>ChIP</em> - genomicProfiles object containing ChIP like scores
for each region</li>
<li>
<em>gof</em> - goodness of fit scores for each regions and mean
scores over all regions.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h3>
<p>Finally, we plot the resulting profiles.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"test.pdf"</span>,height<span class="op">=</span><span class="fl">8</span>,width<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotOccupancyProfile.html">plotOccupancyProfile</a></span><span class="op">(</span>predictedProfile <span class="op">=</span> <span class="va">superFit</span><span class="op">$</span><span class="va">ChIP</span>,</span>
<span>    ChIPScore <span class="op">=</span> <span class="va">testingSet</span>,</span>
<span>    chromatinState <span class="op">=</span> <span class="va">cs_single</span>,</span>
<span>    occupancy <span class="op">=</span> <span class="va">superFit</span><span class="op">$</span><span class="va">occupancy</span>,</span>
<span>    goodnessOfFit <span class="op">=</span> <span class="va">superFit</span><span class="op">$</span><span class="va">gof</span>,</span>
<span>    geneRef <span class="op">=</span> <span class="va">geneRef</span>,</span>
<span>    addLegend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## agg_png </span></span>
<span><span class="co">##       2</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Patrick CN Martin, Nicolea Radu Zabet.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
